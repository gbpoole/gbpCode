INSTALL GUIDE FOR gbpCode AND ITS PACKAGES
==========================================

# Warning: This document is very out of date.  An update will happen when cmake is implemented.

Installing gbpCode
==================

1) Clone a copy of this repository using the command 'git clone https://github.com/gbpoole/gbpCode.git'

2) Create an environment variable called GBP_SRC pointing to this directory location (in what follows,
   I'm assuming you installed gbpCode at ${HOME} ... adjust accordingly) :

   for cshell: setenv GBP_SRC ${HOME}'/gbpCode/'
   for bash:   export GBP_SRC=${HOME}'/gbpCode/'

   gbpCode assumes that this is always set, so ideally put this in your .cshrc or .bashrc so that you 
   just need to define it once and not worry about it after that.

Installing required/optional libraries
======================================

To install gbpCode, you *must* have GSL installed and may want to install one/all of the following:

- MPI
- FFTW (use version 2.1.X, version 3 is not yet supported)
- CFITSIO
- GDLib

If these libraries are already installed, you will have to find the paths to them.  If they are not, 
here's some instructions on where to get them and how to install them (if you have already
configured and sourced your .cshrc/.bashrc as described below, you can use these commads as is, otherwise
you will have to change all the ${GBP_XXX_DIR} references to the paths where you want each library
installed, and then make sure that you use these same paths later when you configure your .cshrc/.bashrc 
as described in the 'Installing gbpCode' section below):

1) Install GSL (REQUIRED; http://www.gnu.org/software/gsl/):
   -----------
   > ./configure prefix=${GBP_GSL_DIR}
   > make
   > make install

2) Install FFTW (optional; http://www.fftw.org/download.html):
   ------------
Make sure you get version 2.  gbpCode does not yet support version 3.

The way gbpCode is set up at present, you need 2 separate compiles (one for single precision, one
for double) of FFTW for both serial and MPI (if you are using it).  To get all of these you need to do 
the following from your FFTW source code directory:

   > make clean
   > ./configure --enable-type-prefix --enable-float --prefix=${GBP_FFTW_DIR}
   > make
   > make install
   > make clean
   > ./configure --enable-type-prefix --prefix=${GBP_FFTW_DIR}
   > make
   > history
   > make install
   > make clean

And if you want to use MPI:

   > make clean
   > ./configure --enable-type-prefix --enable-float --enable-mpi --prefix=${GBP_FFTW_DIR}
   > make
   > make install
   > make clean
   > ./configure --enable-type-prefix --enable-mpi --prefix=${GBP_FFTW_DIR}
   > make
   > history
   > make install
   > make clean

3) Install CFITSIO (optional; http://heasarc.gsfc.nasa.gov/fitsio/):
   ---------------
   > ./configure prefix=${GBP_CFITSIO_DIR}
   > make
   > make install

4) Install MPI (optional; eg. http://www.open-mpi.org/):
   -----------
   > ./configure prefix=${GBP_MPI_DIR}
   > make
   > make install

5) Install Valgrind (optional; http://valgrind.org/downloads/):
   ----------------
   > ./configure prefix=${GBP_VALGRIND_DIR}
   > make
   > make install

If you have Valgrind installed and you want to use it with gbpCode, make sure you compile using:
> make clean ; make SID_DEBUG=1
This compiles the code wih the '-g' option so that Valgrind can report line numbers when errors occur.

6) Install SPRNG (optional; http://sprng.fsu.edu/):
   -------------
This is presently needed for large parallel runs to avoid periodicity in RNG streams.  It is really tough
to compile and GENERALLY NOT NEEDED.  Make sure you use version 1 if you're brave enough to try
to compile it.

Installing additional packages:
==============================

# TODO: implement 'mylocal.cmake' files.

gbpCode was designed so that you can add packages to it.  Once you have gbpCode installed and compiling correctly,
it is pretty easy to add additional packages.

If you add more packages to gbpCode, you should install them in the following way (using the package gbpXXXX as an example):

1) FROM THE $GBP_SRC/gbpPkgs directory, make a clone of the package's repository:

   > cd $GBP_SRC/gbpPkgs
   > git clone https://github.com/gbpoole/gbpXXXX.git

2) Create a Makefile.mylocal file in the gbpPkgs directory and edit it:

  a) cd $GBP_SRC/gbpPkgs
  b) cp Makefile.local Makefile.mylocal (if you haven't already done so)
  c) Edit this Makefile.mylocal file, adding gbpXXXX to the end of the SUBDIRS list

n.b.: the gbpCode makefile always uses Makefile.mylocal instead of Makefile.local, if it exists.
      Makefile.mylocal will not get overwritten the next time you pull from the repo, so any
      changes you make to this file will last through revisions.

Now, everytime you recompile gbpCode (after an update for example) it will also 
recompile all your additional packages to make sure that everything is compatible 
and properly linked.

3) Compile your packages:

   > cd $GBP_SRC/gbpPkgs
   > make clean ; make

If you want MPI versions, then also do the following:

   > cd $GBP_SRC/gbpPkgs
   > make clean ; make USE_MPI=1 

==============================

***QUICK NOTE TO MAC USERS: If you are running an old version of OSX-bash, you will want to fix a bug in the
                            OSX version of echo which does not suppor the '-n' option.  You can do so with 
                            the following commands (for example):

   > sudo port install bash
   > sudo mv /bin/bash /bin/bash.old
   > sudo mv /bin/sh /bin/sh.old
   > sudo ln /opt/local/bin/bash /bin/bash
   > sudo ln /opt/local/bin/bash /bin/sh

Up-to-date Macs don't need to worry about this.

